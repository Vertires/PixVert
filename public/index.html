<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PixVert</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f5f5f5;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(100, 20px);
      grid-template-rows: repeat(100, 20px);
      gap: 2px;
      margin-bottom: 20px;
    }

    .grid-cell {
      width: 20px;
      height: 20px;
      background-color: white;
      border: 1px solid #ddd;
      cursor: pointer;
    }

    .color-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .color-button {
      width: 30px;
      height: 30px;
      border: 1px solid #ddd;
      cursor: pointer;
    }

    .active {
      border: 2px solid black;
    }

    .cooldown {
      margin-top: 20px;
      color: red;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="color-buttons">
      <div class="color-button" style="background-color: red;" onclick="setColor('red')"></div>
      <div class="color-button" style="background-color: blue;" onclick="setColor('blue')"></div>
      <div class="color-button" style="background-color: green;" onclick="setColor('green')"></div>
      <div class="color-button" style="background-color: yellow;" onclick="setColor('yellow')"></div>
    </div>
    <div class="grid" id="grid"></div>
    <div id="cooldownMessage" class="cooldown" style="display: none;">Please wait before placing another pixel.</div>
  </div>

  <script>
    let selectedColor = 'red'; // Default color
    let userId = 'user123'; // You can generate a unique user ID here
    let cooldown = false;

    // Create the grid
    const grid = document.getElementById('grid');
    for (let i = 0; i < 10000; i++) {
      let cell = document.createElement('div');
      cell.classList.add('grid-cell');
      cell.dataset.index = i;
      cell.onclick = () => placePixel(cell);
      grid.appendChild(cell);
    }

    // Function to set the selected color
    function setColor(color) {
      selectedColor = color;
      document.querySelectorAll('.color-button').forEach(button => {
        button.classList.remove('active');
      });
      event.target.classList.add('active');
    }

    // Function to place the pixel on the grid
    async function placePixel(cell) {
      if (cooldown) {
        document.getElementById('cooldownMessage').style.display = 'block';
        return;
      }

      const index = cell.dataset.index;
      const x = index % 100;
      const y = Math.floor(index / 100);

      // Call the backend to place the pixel
      try {
        const response = await fetch('/api/pixels', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ x, y, color: selectedColor, userId })
        });

        const data = await response.json();
        if (data.message === 'Pixel placed') {
          cell.style.backgroundColor = selectedColor;
          cooldown = true;
          document.getElementById('cooldownMessage').style.display = 'block';

          // Reset cooldown after 5 seconds
          setTimeout(() => {
            cooldown = false;
            document.getElementById('cooldownMessage').style.display = 'none';
          }, 5000);
        }
      } catch (error) {
        console.error('Error placing pixel:', error);
      }
    }

    // Fetch the existing pixels from the backend
    async function loadPixels() {
      const response = await fetch('/api/pixels');
      const data = await response.json();
      Object.keys(data).forEach(key => {
        const [x, y] = key.split(',');
        const color = data[key];
        const cell = document.querySelector(`.grid-cell[data-index="${y * 100 + x}"]`);
        if (cell) {
          cell.style.backgroundColor = color;
        }
      });
    }

    // Load the pixels on page load
    window.onload = loadPixels;
  </script>
</body>
</html>
